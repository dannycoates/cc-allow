# cc-allow Global Configuration
# Place at: ~/.config/cc-allow.toml
#
# Provides sensible defaults for common *nix commands and coreutils.
# Project-level configs can add stricter rules on top of this.

version = "2.0"

# ============================================================================
# ALIASES
# ============================================================================

[aliases]
project = "path:$PROJECT_ROOT/**"
claude-user-config = "path:$HOME/.claude/**"
tmp = "path:/tmp/**"
sensitive-read = ["path:$HOME/.ssh/**", "path:**/*.key", "path:**/*.pem"]
sensitive-write = [
    "path:$HOME/.*",
    "path:/etc/**",
    "path:/usr/**",
    "path:/bin/**",
    "path:/sbin/**",
    "path:/lib/**",
    "path:/lib64/**",
    "path:/var/**",
    "path:/boot/**",
    "path:/root/**",
    "path:/",
]

# ============================================================================
# BASH TOOL CONFIGURATION
# ============================================================================

[bash]
default = "ask"
dynamic_commands = "ask"
default_message = "Command not in allow list"
unresolved_commands = "ask"

[bash.constructs]
function_definitions = "deny"
background = "ask"
subshells = "ask"
heredocs = "allow"

# ============================================================================
# ALLOWED COMMANDS
# ============================================================================

[bash.allow]
commands = [
    # Claude scripts
    "alias:claude-user-config",

    # File & Directory Navigation
    "ls", "dir", "vdir",
    "pwd",
    "tree",
    "file",
    "stat",
    "basename", "dirname",
    "realpath", "readlink",

    # File Viewing & Reading
    "cat", "tac",
    "head", "tail",
    "less", "more",
    "nl",
    "od", "hexdump", "xxd",

    # Text Processing & Transformation
    "grep", "egrep", "fgrep",
    "sed", "awk", "gawk",
    "cut", "paste", "join",
    "sort", "uniq", "shuf",
    "tr", "rev",
    "expand", "unexpand",
    "fold", "fmt",
    "column",
    "pr",
    "wc",
    "comm", "diff", "cmp", "colordiff", "delta",
    "iconv",
    "strings",

    # Searching & Finding
    "find",
    "fd",
    "locate", "mlocate", "plocate",
    "which", "whereis", "type",
    "xargs",
    "rg", "ripgrep",
    "ag",
    "fzf",

    # File Operations (Non-Destructive)
    "cp",
    "mv",
    "touch",
    "mkdir",
    "ln",
    "install",
    "rm",
    "rmdir",

    # Archive & Compression
    "tar",
    "gzip", "gunzip", "zcat",
    "bzip2", "bunzip2", "bzcat",
    "xz", "unxz", "xzcat",
    "zstd", "unzstd", "zstdcat",
    "zip", "unzip",
    "7z", "7za", "7zr",
    "rar", "unrar",

    # Printing & Output
    "echo", "printf",
    "yes",
    "seq",
    "tee",

    # Date, Time & Calculation
    "date",
    "cal", "ncal",
    "time",
    "bc", "dc",
    "expr",
    "factor",

    # User & System Info (Read-Only)
    "whoami",
    "id",
    "groups",
    "who", "w",
    "users",
    "last", "lastlog",
    "finger",
    "uname",
    "hostname",
    "hostnamectl",
    "uptime",
    "arch",
    "nproc",
    "lscpu",
    "lsmem",
    "free",
    "df",
    "du",
    "lsblk",
    "lsusb",
    "lspci",
    "lsof",
    "dmesg",

    # Process Inspection (Read-Only)
    "ps",
    "top", "htop",
    "pgrep", "pidof",
    "pstree",
    "jobs",
    "nice", "renice",

    # Network Inspection (Read-Only)
    "ping", "ping6",
    "traceroute", "tracepath",
    "mtr",
    "dig", "nslookup", "host",
    "whois",
    "ip",
    "ifconfig",
    "ss", "netstat",
    "nc", "netcat",
    "nmap",
    "tcpdump",

    # Shell Builtins & Utilities
    "test", "[", "[[",
    "true", "false",
    "sleep",
    "env", "printenv",

    # Version Control
    "git",
    "gh",
    "hg",
    "svn",
    "fossil",

    # Build Tools
    # - please customize to your project's needs

    # Misc Utilities
    "man", "info", "help",
    "apropos", "whatis",
    "tldr",
    "watch",
    "timeout",
    "strace", "ltrace",
    "md5sum", "sha1sum", "sha256sum", "sha512sum",
    "base64",
    "nix", "nix-env", "nix-shell",
    "jq",
    "sd",
    "fd",
    "eza",
]

# ============================================================================
# DENIED COMMANDS
# ============================================================================

[bash.deny]
commands = [
    # Privilege escalation
    "sudo", "su", "doas", "pkexec",
    # Disk/filesystem operations
    "dd", "mkfs", "fdisk", "parted", "gdisk", "cfdisk", "sfdisk",
    "mkswap", "swapon", "swapoff",
    "mount", "umount",
    "losetup",
    "lvm", "pvcreate", "vgcreate", "lvcreate",
    # System control
    "shutdown", "reboot", "halt", "poweroff", "init", "telinit",
    # User/group management
    "useradd", "userdel", "usermod",
    "groupadd", "groupdel", "groupmod",
    "passwd", "chpasswd",
    "chsh", "chfn",
    # Mass process control
    "killall", "pkill",
    # Dangerous network
    "iptables", "ip6tables", "nft", "firewall-cmd",
    "route",
    # System modification
    "sysctl",
    "modprobe", "insmod", "rmmod",
    "update-grub", "grub-install",
]
message = "{{.Command}} blocked - dangerous system command"

# ============================================================================
# REDIRECTS
# ============================================================================

[bash.redirects]
respect_file_rules = true

[[bash.redirects.allow]]
paths = ["/dev/null", "/dev/stderr", "/dev/stdout"]

[[bash.redirects.deny]]
message = "Cannot redirect to system directories"
paths = [
    "path:/etc/**",
    "path:/usr/**",
    "path:/bin/**",
    "path:/sbin/**",
    "path:/lib/**",
    "path:/lib64/**",
    "path:/var/**",
    "path:/boot/**",
    "path:/root/**",
]

[[bash.redirects.deny]]
message = "Cannot modify shell configuration files"
paths = [
    "path:$HOME/.*rc",
    "path:$HOME/.*shrc",
    "path:$HOME/.*profile",
    "path:$HOME/.*_profile",
    "path:$HOME/.*login",
    "path:$HOME/.*_login",
    "path:$HOME/.*logout",
    "path:$HOME/.*_logout",
]

# ============================================================================
# SPECIFIC RULES
# ============================================================================

# --- chmod: Ask when making files executable ---
[[bash.ask.chmod]]
message = "{{.ArgsStr}} - making files executable requires review"
args.any = ["re:\\+x", "re:[0-7][1357][0-7]", "re:[0-7][0-7][1357]"]

# --- chmod: Allow other chmod operations ---
[[bash.allow.chmod]]

# --- chown/chgrp: Ask (ownership changes are sensitive) ---
[[bash.ask.chown]]
message = "{{.ArgsStr}} - ownership change requires review"

[[bash.ask.chgrp]]
message = "{{.ArgsStr}} - group change requires review"

# --- git: Block force push ---
[[bash.ask.git.push]]
message = "{{.ArgsStr}} - force push not allowed"
args.any = ["--force", "flags:f", "--force-with-lease"]

# --- git: Block hard reset ---
[[bash.ask.git.reset]]
message = "{{.ArgsStr}} - hard reset may lose work"
args.any = ["--hard"]

# --- git: Ask for clean -f ---
[[bash.ask.git.clean]]
message = "{{.ArgsStr}} - git clean requires review"
args.any = ["flags:f", "--force"]

# --- sed/awk: Block in-place editing ---
[[bash.ask.sed]]
message = "{{.ArgsStr}} - in-place editing not allowed, use Edit tool"
args.any = ["flags:i", "--in-place"]

[[bash.ask.awk]]
message = "{{.ArgsStr}} - in-place editing not allowed, use Edit tool"
args.any = ["flags:i"]

# --- Block piping to shell from download commands ---
[[bash.ask.bash]]
message = "{{.Command}} receiving from {{index .PipesFrom 0}} - piping to shell not allowed"
pipe.from = ["curl", "wget", "http"]

[[bash.ask.sh]]
message = "{{.Command}} receiving from {{index .PipesFrom 0}} - piping to shell not allowed"
pipe.from = ["curl", "wget", "http"]

[[bash.ask.zsh]]
message = "{{.Command}} receiving from {{index .PipesFrom 0}} - piping to shell not allowed"
pipe.from = ["curl", "wget", "http"]

# --- docker/podman: Block privileged containers ---
[[bash.ask.docker]]
message = "{{.ArgsStr}} - privileged containers not allowed"
args.any = ["--privileged"]

[[bash.ask.podman]]
message = "{{.ArgsStr}} - privileged containers not allowed"
args.any = ["--privileged"]

# --- ssh: Ask for custom options ---
[[bash.ask.ssh]]
message = "{{.ArgsStr}} - ssh with custom options requires review"
args.any = ["flags:o"]

# ============================================================================
# FILE TOOL PERMISSIONS
# ============================================================================

[read]
default = "ask"

[read.allow]
paths = ["alias:project", "alias:tmp", "alias:claude-user-config"]

[read.deny]
paths = ["alias:sensitive-read"]
message = "Cannot read {{.FileName}} - sensitive file"

[edit]
default = "ask"

[edit.allow]
paths = ["alias:project", "alias:claude-user-config"]

[edit.deny]
paths = ["path:$HOME/.*"]
message = "Cannot edit {{.FileName}} - sensitive file"

[write]
default = "ask"

[write.allow]
paths = ["alias:project", "alias:tmp", "alias:claude-user-config"]

[write.deny]
paths = ["alias:sensitive-write"]
message = "Cannot write to {{.FilePath}} - system directory"

[webfetch]
default = "allow"
default_message = "URL fetch requires approval: {{.FilePath}}"

[webfetch.safe_browsing]
enabled = true
# use your own key - not this one
api_key = "AIzaSyBPGXa4AYD4FC3HJK7LnIKxm4fDusVuuco"

# File rule integration test ruleset
# Tests that bash commands respect file rules based on their arguments
# This tests the new respect_file_rules feature

version = "1.0"

[policy]
default = "allow"
respect_file_rules = true  # Enable checking file rules for command arguments

[redirects]
respect_file_rules = true  # Enable checking file rules for redirect targets

# ============================================================================
# ALLOWED COMMANDS
# ============================================================================

[allow]
commands = ["cat", "head", "tail", "less", "grep", "wc", "rm", "touch", "cp", "mv", "echo"]

# ============================================================================
# DENIED COMMANDS
# ============================================================================

[deny]
commands = ["sudo"]

# ============================================================================
# FILE RULES - Applied to command arguments
# ============================================================================

[files]
default = "allow"

[files.read]
allow = [
    "path:/project/**",
    "path:/home/user/**",
    "path:/tmp/**",
]
deny = [
    "path:**/.ssh/**",
    "path:**/*.key",
    "path:**/*.pem",
    "path:**/.env*",
    "path:/etc/**",
    "path:/secrets/**",
]

[files.write]
allow = [
    "path:/project/**",
    "path:/tmp/**",
]
deny = [
    "path:/etc/**",
    "path:/usr/**",
    "path:/bin/**",
    "path:/protected/**",
    "path:**/.ssh/**",
    "path:**/*.key",
]

[files.edit]
allow = [
    "path:/project/**",
]
deny = [
    "path:/etc/**",
    "path:**/.env*",
]

# ============================================================================
# SPECIFIC RULES
# ============================================================================

# cp: position 0 = source (read), position 1 = dest (write)
[[allow.cp]]
args.position = { "0" = "files:read", "1" = "files:write" }

# mv: position 0 = source (read), position 1 = dest (write)
[[allow.mv]]
args.position = { "0" = "files:read", "1" = "files:write" }

# tar: disable file rule checking for complex command
[[allow.tar]]
respect_file_rules = false

# Custom command with Write access type override
[[allow.mywrite]]
file_access_type = "Write"

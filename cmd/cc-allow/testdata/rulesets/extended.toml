# Extended argument matching ruleset
# Tests position enums, any_match sequences, and all_match sequences

[policy]
default = "ask"
dynamic_commands = "deny"

[commands.allow]
names = ["echo", "ls", "cat"]

# Position with enum values (OR semantics)
[[rule]]
command = "git"
action = "allow"
message = "Safe read-only git commands"
[rule.args]
position = { "0" = ["status", "diff", "log", "branch", "show", "blame"] }

[[rule]]
command = "git"
action = "deny"
message = "Network git operations denied"
[rule.args]
position = { "0" = ["push", "pull", "fetch", "clone"] }

# any_match with sequence objects
[[rule]]
command = "ffmpeg"
action = "allow"
message = "ffmpeg with safe input path"
[rule.args]
any_match = [
    { "0" = "-i", "1" = "path:$HOME/**" },
    { "0" = "-i", "1" = "path:$PROJECT_ROOT/**" }
]

[[rule]]
command = "ffmpeg"
action = "deny"
message = "ffmpeg with system input denied"
[rule.args]
any_match = [
    { "0" = "-i", "1" = "path:/etc/**" },
    { "0" = "-i", "1" = "path:/sys/**" }
]

# any_match mixing strings and sequences
[[rule]]
command = "curl"
action = "allow"
message = "Allowed curl patterns"
[rule.args]
any_match = [
    "re:^https://localhost",
    "re:^http://127\\.0\\.0\\.1",
    { "0" = "-o", "1" = "path:/tmp/**" }
]

# all_match with sequences (multiple required pairs)
[[rule]]
command = "openssl"
action = "allow"
message = "openssl with proper in/out"
[rule.args]
all_match = [
    { "0" = "-in", "1" = ["glob:*.pem", "glob:*.crt", "glob:*.key"] },
    { "0" = "-out", "1" = ["glob:*.pem", "glob:*.crt", "glob:*.der"] }
]

# Position enum with multiple positions
[[rule]]
command = "docker"
action = "allow"
message = "Safe docker inspect commands"
[rule.args]
position = { "0" = ["ps", "images", "inspect", "logs"], "1" = ["--format", "-f", "--tail", "--help"] }

[[rule]]
command = "docker"
action = "deny"
message = "Dangerous docker commands"
[rule.args]
position = { "0" = ["rm", "rmi", "kill", "stop"] }

# Sequence with 3+ positions
[[rule]]
command = "rsync"
action = "allow"
message = "rsync with specific flags"
[rule.args]
any_match = [
    { "0" = "-a", "1" = "-v", "2" = "--progress" }
]

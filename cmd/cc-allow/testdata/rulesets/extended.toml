# Extended argument matching ruleset
# Tests position enums, any sequences, and all sequences

version = "2.0"

# ============================================================================
# BASH TOOL CONFIGURATION
# ============================================================================

[bash]
default = "ask"
dynamic_commands = "deny"

[bash.allow]
commands = ["echo", "ls", "cat"]

# ============================================================================
# POSITION WITH ENUM VALUES (OR SEMANTICS)
# ============================================================================

# Allow safe read-only git commands
[[bash.allow.git]]
message = "Safe read-only git commands"
args.position = { "0" = ["status", "diff", "log", "branch", "show", "blame"] }

# Deny network git operations
[[bash.deny.git]]
message = "Network git operations denied"
args.position = { "0" = ["push", "pull", "fetch", "clone"] }

# ============================================================================
# ANY WITH SEQUENCE OBJECTS
# ============================================================================

# ffmpeg with safe input path
[[bash.allow.ffmpeg]]
message = "ffmpeg with safe input path"
args.any = [
    { "0" = "-i", "1" = "path:$HOME/**" },
    { "0" = "-i", "1" = "path:$PROJECT_ROOT/**" }
]

# ffmpeg with system input denied
[[bash.deny.ffmpeg]]
message = "ffmpeg with system input denied"
args.any = [
    { "0" = "-i", "1" = "path:/etc/**" },
    { "0" = "-i", "1" = "path:/sys/**" }
]

# ============================================================================
# ANY MIXING STRINGS AND SEQUENCES
# ============================================================================

# Allowed curl patterns
[[bash.allow.curl]]
message = "Allowed curl patterns"
args.any = [
    "re:^https://localhost",
    "re:^http://127\\.0\\.0\\.1",
    { "0" = "-o", "1" = "path:/tmp/**" }
]

# ============================================================================
# ALL WITH SEQUENCES (MULTIPLE REQUIRED PAIRS)
# ============================================================================

# openssl with proper in/out
[[bash.allow.openssl]]
message = "openssl with proper in/out"
args.all = [
    { "0" = "-in", "1" = ["path:*.pem", "path:*.crt", "path:*.key"] },
    { "0" = "-out", "1" = ["path:*.pem", "path:*.crt", "path:*.der"] }
]

# ============================================================================
# POSITION ENUM WITH MULTIPLE POSITIONS
# ============================================================================

# Safe docker inspect commands
[[bash.allow.docker]]
message = "Safe docker inspect commands"
args.position = { "0" = ["ps", "images", "inspect", "logs"], "1" = ["--format", "-f", "--tail", "--help"] }

# Dangerous docker commands
[[bash.deny.docker]]
message = "Dangerous docker commands"
args.position = { "0" = ["rm", "rmi", "kill", "stop"] }

# ============================================================================
# SEQUENCE WITH 3+ POSITIONS
# ============================================================================

# rsync with specific flags
[[bash.allow.rsync]]
message = "rsync with specific flags"
args.any = [
    { "0" = "-a", "1" = "-v", "2" = "--progress" }
]

# Pluginroot ruleset - tests $CLAUDE_PLUGIN_ROOT variable expansion
# Used to verify skills/plugins can restrict commands to their own directories

version = "2.0"

# ============================================================================
# ALIASES
# ============================================================================

[aliases]
plugin = "path:$CLAUDE_PLUGIN_ROOT/**"

# ============================================================================
# BASH TOOL CONFIGURATION
# ============================================================================

[bash]
default = "deny"
dynamic_commands = "deny"

[bash.constructs]
function_definitions = "deny"
background = "deny"
heredocs = "allow"

# ============================================================================
# ALLOWED COMMANDS
# ============================================================================

[bash.allow]
commands = ["echo", "ls", "cat", "pwd"]

# ============================================================================
# DENIED COMMANDS
# ============================================================================

[bash.deny]
commands = ["sudo", "su"]
message = "Privilege escalation denied"

# ============================================================================
# PLUGIN ROOT PATH TESTS
# ============================================================================

# Allow read commands within plugin root
[[bash.allow.cat]]
message = "Allowed: reading files within plugin"
args.all = ["alias:plugin"]

# Deny cat outside plugin root (more specific due to path pattern)
[[bash.deny.cat]]
message = "Cannot read files outside plugin directory"
args.any = ["!path:$CLAUDE_PLUGIN_ROOT/**"]

# Allow script execution within plugin
[[bash.allow.bash]]
message = "Allowed: running scripts within plugin"
args.position = { "0" = "path:$CLAUDE_PLUGIN_ROOT/**" }

# Deny bash scripts outside plugin
[[bash.deny.bash]]
message = "Cannot run scripts outside plugin directory"

# Allow touch within plugin root
[[bash.allow.touch]]
args.all = ["alias:plugin"]

# Deny touch outside plugin root
[[bash.deny.touch]]
message = "Cannot create files outside plugin directory"

# Allow rm within plugin root only
[[bash.allow.rm]]
message = "Allowed: removing files within plugin"
args.all = ["alias:plugin"]

# Deny rm outside plugin root
[[bash.deny.rm]]
message = "Cannot remove files outside plugin directory"

# ============================================================================
# REDIRECT RULES FOR PLUGIN ROOT
# ============================================================================

# Allow redirects within plugin root
[[bash.redirects.allow]]
paths = ["alias:plugin"]

# Deny redirects outside plugin root
[[bash.redirects.deny]]
message = "Cannot write files outside plugin directory"

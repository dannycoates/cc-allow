# Permissive ruleset - allows most things, only blocks truly dangerous commands

version = "1.0"

[policy]
default = "allow"
dynamic_commands = "ask"
default_message = "Command not allowed"

# ============================================================================
# DENIED COMMANDS
# ============================================================================

[deny]
commands = ["sudo", "su", "dd", "mkfs", "shutdown", "reboot"]
message = "System-level command denied"

# ============================================================================
# SHELL CONSTRUCTS
# ============================================================================

[constructs]
function_definitions = "allow"
background = "allow"
subshells = "allow"

# ============================================================================
# SPECIFIC RULES - Block shells from receiving piped input from download commands
# This catches both direct (curl | bash) and indirect (curl | cat | bash) pipes
# ============================================================================

[[deny.bash]]
message = "bash cannot receive piped input from download commands"
pipe.from = ["curl", "wget"]

[[deny.sh]]
message = "sh cannot receive piped input from download commands"
pipe.from = ["curl", "wget"]

[[deny.zsh]]
message = "zsh cannot receive piped input from download commands"
pipe.from = ["curl", "wget"]

# ============================================================================
# REDIRECTS - Block writes to sensitive paths
# ============================================================================

[[redirect]]
action = "deny"
message = "Cannot write to system paths"
[redirect.to]
pattern = ["re:^/etc/.*", "re:^/usr/.*", "re:^/bin/.*", "re:^/sbin/.*"]

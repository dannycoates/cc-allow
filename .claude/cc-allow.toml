# cc-allow config for development projects
# Sensible defaults: allow dev tools, block dangerous operations

[policy]
default = "ask"                    # defer to Claude Code's permission system
dynamic_commands = "deny"           # block $VAR or $(cmd) as command names
default_message = "Command not allowed by project policy"

# Common safe commands for development
[commands.allow]
names = [
    # File & Directory Navigation
    "ls", "dir", "vdir", "pwd", "tree", "file", "stat",
    "basename", "dirname", "realpath", "readlink",
    # File Viewing & Reading
    "cat", "tac", "head", "tail", "less", "more", "nl",
    "od", "hexdump", "xxd",
    # Text Processing & Transformation
    "grep", "egrep", "fgrep", "sed", "awk", "gawk",
    "cut", "paste", "join", "sort", "uniq", "shuf",
    "tr", "rev", "expand", "unexpand", "fold", "fmt", "column", "pr",
    "wc", "comm", "diff", "cmp", "colordiff", "delta", "iconv", "strings",
    # Searching & Finding
    "find", "fd", "locate", "mlocate", "plocate",
    "which", "whereis", "type", "xargs",
    "rg", "ripgrep", "ag", "fzf",
    # File Operations (Non-Destructive)
    "cp", "mv", "touch", "mkdir", "ln", "install",
    # Archive & Compression
    "tar", "gzip", "gunzip", "zcat", "bzip2", "bunzip2", "bzcat",
    "xz", "unxz", "xzcat", "zstd", "unzstd", "zstdcat",
    "zip", "unzip", "7z", "7za", "7zr", "rar", "unrar",
    # Printing & Output
    "echo", "printf", "yes", "seq", "tee",
    # Date, Time & Calculation
    "date", "cal", "ncal", "time", "bc", "dc", "expr", "factor",
    # User & System Info (Read-Only)
    "whoami", "id", "groups", "who", "w", "users", "last", "lastlog", "finger",
    "uname", "hostname", "hostnamectl", "uptime", "arch", "nproc",
    "lscpu", "lsmem", "free", "df", "du", "lsblk", "lsusb", "lspci", "lsof", "dmesg",
    # Process inspection (read-only)
    "ps", "top", "htop", "pgrep", "pidof", "pstree", "jobs", "nice", "renice",
    # Network inspection (read-only)
    "ping", "ping6", "traceroute", "tracepath", "mtr",
    "dig", "nslookup", "host", "whois",
    "ip", "ifconfig", "ss", "netstat", "nc", "netcat", "nmap", "tcpdump",
    # Shell Builtins & Utilities
    "test", "[", "[[", "true", "false", "sleep", "env", "printenv",
    # Version Control
    "git", "gh", "hg", "svn", "fossil",
    # Go development
    "go", "gofmt", "golint", "gopls",
    # Build tools
    "make", "just", "cargo", "npm", "yarn", "pnpm", "bun",
    # Editors & viewers
    "vim", "nvim", "nano", "code",
    # Misc Utilities
    "man", "info", "help", "apropos", "whatis", "tldr",
    "watch", "timeout", "strace", "ltrace",
    "md5sum", "sha1sum", "sha256sum", "sha512sum", "base64",
    "nix", "nix-env", "nix-shell",
    # Us
    "path:$PROJECT_ROOT/cc-allow", "cc-query", "path:/tmp/cc-allow-test",
    # Remove commands (handled by rules below)
    "rm", "rmdir", "chmod",
]

# Dangerous commands - always block
[commands.deny]
names = [
    "sudo", "su", "doas",           # privilege escalation
    "dd", "mkfs", "fdisk", "parted", # disk operations
    "shutdown", "reboot", "halt",   # system control
    "killall", "pkill",             # mass process killing
]
message = "Dangerous command blocked by project policy"

[constructs]
function_definitions = "deny"       # prevent command shadowing
background = "ask"                 # allow but defer to Claude Code
subshells = "ask"

# Block recursive rm - the -r flag can appear anywhere in a dash group (e.g., -r, -rf, -fr)
[[rule]]
command = "rm"
action = "deny"
message = "Recursive rm not allowed"
[rule.args]
any_match = ["re:^-[a-zA-Z]*r[a-zA-Z]*$", "--recursive"]

[[rule]]
command = "curl"
action = "deny"
message = "Use WebFetch tool instead"

[[rule]]
command = "wget"
action = "deny"
message = "Use WebFetch tool instead"

[[rule]]
command = "fetch"
action = "deny"
message = "Use WebFetch tool instead"

# Block dangerous git operations
[[rule]]
command = "git"
action = "deny"
message = "Force push not allowed"
[rule.args]
any_match = ["--force", "-f"]
contains = ["push"]

[[rule]]
command = "git"
action = "deny"
message = "Hard reset not allowed"
[rule.args]
contains = ["reset", "--hard"]

# Allow redirecting to /dev/null
[[redirect]]
action = "allow"
[redirect.to]
exact = ["/dev/null"]

# Allow writes to /tmp
[[redirect]]
action = "allow"
[redirect.to]
pattern = ["path:/tmp/**"]

# Block writes to system directories
[[redirect]]
action = "deny"
message = "Cannot write to system directories"
[redirect.to]
pattern = ["path:etc/**", "path:/usr/**", "path:/bin/**", "path:/sbin/**", "path:/var/**"]

# Block writes to home directory dotfiles
[[redirect]]
action = "deny"
message = "Cannot modify shell configuration files"
[redirect.to]
exact = [".bashrc", ".zshrc", ".profile", ".bash_profile", ".zprofile"]

# Allow cd only to /tmp and project root
[[rule]]
command = "cd"
action = "allow"
[rule.args]
any_match = ["path:/tmp/**", "path:$PROJECT_ROOT/**"]

# Block cd to anywhere else
[[rule]]
command = "cd"
action = "deny"
message = "cd only allowed to /tmp or project directory"
